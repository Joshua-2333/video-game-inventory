<!-- views/games.ejs -->
 <h1>All Games</h1>
<p>Filter games by genre and platform:</p>

<!-- Filter section -->
<div class="filters" style="margin-bottom: 20px;">
  <label for="genreFilter">Filter by Genre:</label>
  <select id="genreFilter" onchange="filterGames()">
    <option value="all">All Genres</option>
    <% 
      const allGenres = [...new Set(games.map(g => g.genre).filter(Boolean))];
      allGenres.forEach(genre => { 
    %>
      <option value="<%= genre %>"><%= genre %></option>
    <% }) %>
  </select>

  <label for="platformFilter" style="margin-left: 20px;">Filter by Platform:</label>
  <select id="platformFilter" onchange="filterGames()">
    <option value="all">All Platforms</option>
    <% 
      const allPlatforms = [...new Set(games.flatMap(g => g.platforms || []).filter(Boolean))];
      allPlatforms.forEach(platform => { 
    %>
      <option value="<%= platform %>"><%= platform %></option>
    <% }) %>
  </select>
</div>

<!-- Games grid -->
<div id="gamesList" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap:15px;">
  <% 
    // Use a Map to prevent duplicate game cards
    const displayed = new Map();
    games.forEach(game => {
      if (!displayed.has(game.name)) {
        displayed.set(game.name, game);
  %>
      <div class="game-card"
           data-genre="<%= game.genre || 'Unknown' %>"
           data-platforms="<%= game.platforms && game.platforms.length ? game.platforms.join(',') : '' %>"
           style="border:1px solid #ccc; padding:10px; border-radius:5px;">
        <h3><%= game.name %></h3>
        <p><strong>Genre:</strong> <%= game.genre || 'Unknown' %></p>
        <p><strong>Platforms:</strong> <%= game.platforms && game.platforms.length ? game.platforms.join(', ') : 'No Platforms' %></p>
        <p><strong>Price:</strong> $<%= game.price %></p>
        <p><strong>Condition:</strong> <%= game.item_condition %></p>
      </div>
  <% 
      }
    }) 
  %>
</div>

<p id="noGames" style="display:none; margin-top:10px;">No games match the selected filters.</p>

<script>
  function filterGames() {
    const genreFilter = document.getElementById('genreFilter').value;
    const platformFilter = document.getElementById('platformFilter').value;
    const items = document.querySelectorAll('#gamesList .game-card');
    let visibleCount = 0;

    items.forEach(item => {
      const genre = item.dataset.genre;
      const platforms = item.dataset.platforms ? item.dataset.platforms.split(',') : [];
      const genreMatch = genreFilter === 'all' || genre === genreFilter;
      const platformMatch =
        platformFilter === 'all' ||
        (platformFilter === 'PS' && (platforms.includes('PS3') || platforms.includes('PS4') || platforms.includes('PS5'))) ||
        platforms.includes(platformFilter);

      if (genreMatch && platformMatch) {
        item.style.display = 'block';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    document.getElementById('noGames').style.display = visibleCount === 0 ? 'block' : 'none';
  }
</script>

<a href="/" style="display:block; margin-top:20px;">‚Üê Back to Home</a>
