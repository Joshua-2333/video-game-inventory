<!-- categoryDetail.ejs -->
<h1><%= category.name %></h1>
<p><%= category.description %></p>

<% if (category.name === 'Games') { %>
  <!-- Filters -->
  <div class="filters" style="margin-bottom: 20px;">
    <label for="genreFilter">Genre:</label>
    <select id="genreFilter" onchange="filterGames()">
      <option value="all">All</option>
      <% 
        const allGenres = [...new Set(items.map(item => item.genre))].sort();
        allGenres.forEach(genre => { 
      %>
        <option value="<%= genre %>"><%= genre %></option>
      <% }) %>
    </select>

    <label for="platformFilter" style="margin-left: 20px;">Platform:</label>
    <select id="platformFilter" onchange="filterGames()">
      <option value="all">All</option>
      <% 
        const allPlatforms = [...new Set(items.flatMap(item => item.platforms))].sort();
        allPlatforms.forEach(platform => { 
      %>
        <option value="<%= platform %>"><%= platform %></option>
      <% }) %>
    </select>
  </div>

  <!-- Games list -->
  <div id="gamesList" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap:15px;">
    <% items.forEach(item => { %>
      <div class="game-card"
           data-genre="<%= item.genre %>"
           data-platforms="<%= item.platforms.join(',') %>"
           style="border:1px solid #ccc; padding:10px; border-radius:5px;">
        <h3><%= item.name %></h3>
        <p>Genre: <%= item.genre %></p>
        <p>Platforms: <%= item.platforms.join(', ') %></p>
        <p>Price: $<%= item.price %></p>
        <p>Condition: <%= item.item_condition %></p>
        <a href="/items/<%= item.id %>/edit">âœï¸ Edit</a>
        <form action="/items/<%= item.id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
          <button type="submit">ğŸ—‘ï¸ Delete</button>
        </form>
      </div>
    <% }) %>
  </div>

  <p id="noGames" style="display:none; margin-top:10px;">No games match the selected filters.</p>

  <script>
    function filterGames() {
      const genreFilter = document.getElementById('genreFilter').value;
      const platformFilter = document.getElementById('platformFilter').value;
      const gameCards = document.querySelectorAll('#gamesList .game-card');
      let visibleCount = 0;

      gameCards.forEach(card => {
        const genre = card.dataset.genre;
        const platforms = card.dataset.platforms.split(',');

        const genreMatch = genreFilter === 'all' || genre === genreFilter;
        const platformMatch =
          platformFilter === 'all' ||
          (platformFilter === 'PS' && (platforms.includes('PS3') || platforms.includes('PS4') || platforms.includes('PS5'))) ||
          platforms.includes(platformFilter);

        if (genreMatch && platformMatch) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      document.getElementById('noGames').style.display = visibleCount === 0 ? 'block' : 'none';
    }
  </script>

<% } else { %>
  <!-- Non-Games categories -->
  <h2>Items in this category:</h2>
  <% if (items.length) { %>
    <ul>
      <% items.forEach(item => { %>
        <li>
          <strong><%= item.name %></strong> â€” $<%= item.price %> â€” <%= item.item_condition %>
          <a href="/items/<%= item.id %>/edit">âœï¸ Edit</a>
          <form action="/items/<%= item.id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
            <button type="submit">ğŸ—‘ï¸ Delete</button>
          </form>
        </li>
      <% }) %>
    </ul>
  <% } else { %>
    <p>No items in this category.</p>
  <% } %>
<% } %>

<hr />
<a href="/items/new/<%= category.id %>">â• Add New Item</a><br />
<a href="/categories/<%= category.id %>/edit">âœï¸ Edit Category</a>
<form action="/categories/<%= category.id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this category?');">
  <button type="submit">ğŸ—‘ï¸ Delete Category</button>
</form>
<a href="/">â† Back to Home</a>
